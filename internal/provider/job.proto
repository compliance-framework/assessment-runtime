syntax = "proto3";

import "google/protobuf/struct.proto";

package plugin;
option go_package = "./provider";

message Expression {
  string Key = 1;
  string Operator = 2;
  repeated string Values = 3;
}

message SubjectSelector {
  string Query = 1;
  map<string, string> Labels = 2;
  repeated Expression Expressions = 3;
  repeated string Ids = 4;
}

message Subject {
  string Id = 1;
  map<string, string> Labels = 2;
}

message SubjectList {
  repeated Subject Subjects = 1;
}

message ActionInput {
  Subject Subject = 1;
  string AssessmentId = 2;
  string SSPId = 3;
  string ControlId = 4;
  string ComponentId = 5;
  map<string, string> Config = 6;
  map<string, string> Parameters = 7;
}

message ActionOutput {
  Subject Subject = 1;
  string SSPId = 2;
  string ControlId = 3;
  string ComponentId = 4;
  string AssessmentID = 5;
  bool Compliant = 6;
  google.protobuf.Struct ResultData = 7;
  string Error = 8;
}

service JobService {
  rpc EvaluateSelector (SubjectSelector) returns (SubjectList);
  rpc Execute (ActionInput) returns (ActionOutput);
}
